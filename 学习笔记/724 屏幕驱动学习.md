## 724 屏幕驱动学习



- 屏幕型号 "color_lcd_spi_st7789"
- 









- 学习目标

  1. 需要制作出如下的UI 界面，跳转就根据延时跳转( UI 界面将来可以用在产品的展示上面 )

  ![1](724%20%E5%B1%8F%E5%B9%95%E9%A9%B1%E5%8A%A8%E5%AD%A6%E4%B9%A0.assets/1.jpg)

  ![2](724%20%E5%B1%8F%E5%B9%95%E9%A9%B1%E5%8A%A8%E5%AD%A6%E4%B9%A0.assets/2.jpg)

  ![4](724%20%E5%B1%8F%E5%B9%95%E9%A9%B1%E5%8A%A8%E5%AD%A6%E4%B9%A0.assets/4.jpg)

  2. 对于网络信号也采用图片组件的方式进行调整





### LVGL(一种开源的图形库)

任务: 使用LVGL 生成之前的演示箱的界面

- LVGL 官方使用C语言开发，而合宙在LVGL 基础上制作的Lua 语言版本

  [合宙官方LVGL API](https://doc.openluat.com/wiki/31?wiki_page_id=3977)

  [合宙LVGL API库2( 解释不明确 )](https://wiki.luatos.com/api/lvgl.html#)

  ```bash
  对于界面使用的图片而言，导入外部图片需采用bin 格式的图像
  
  ```

[LVGL官方C++ API 文档地址](https://docs.lvgl.io/master/API/core/lv_obj_pos.html#_CPPv412lv_obj_alignP9_lv_obj_t10lv_align_t10lv_coord_t10lv_coord_t)

> 图像有关函数

- 图像位置的设置

  ```C++
  // 设置图像的位置。 Lua 中函数名 lvgl.obj_align()
  void lv_obj_align( struct _lv_obj_t *obj, lv_align_t align,lv_coord_t x_ofs, lv_coord_t y_ofs );
  /*
  形参：
      obj -- pointer to an object to align
      align -- type of alignment (see 'lv_align_t' enum) LV_ALIGN_OUT_... can't be used.
      x_ofs -- x coordinate offset after alignment
      y_ofs -- y coordinate offset after alignment
  */  
  /*
  align 参数 
  官方地址：https://docs.lvgl.io/master/API/misc/lv_area.html#_CPPv411_lv_align_t
  定位： lv_area.h -> Enums -> enum _lv_align_t
  */
  Values:
  enumerator LV_ALIGN_DEFAULT
  enumerator LV_ALIGN_TOP_LEFT
  enumerator LV_ALIGN_TOP_MID
  enumerator LV_ALIGN_TOP_RIGHT
  enumerator LV_ALIGN_BOTTOM_LEFT
  enumerator LV_ALIGN_BOTTOM_MID
  enumerator LV_ALIGN_BOTTOM_RIGHT
  enumerator LV_ALIGN_LEFT_MID
  enumerator LV_ALIGN_RIGHT_MID
  enumerator LV_ALIGN_CENTER
  enumerator LV_ALIGN_OUT_TOP_LEFT
  enumerator LV_ALIGN_OUT_TOP_MID
  enumerator LV_ALIGN_OUT_TOP_RIGHT
  enumerator LV_ALIGN_OUT_BOTTOM_LEFT
  enumerator LV_ALIGN_OUT_BOTTOM_MID
  enumerator LV_ALIGN_OUT_BOTTOM_RIGHT
  enumerator LV_ALIGN_OUT_LEFT_TOP
  enumerator LV_ALIGN_OUT_LEFT_MID
  enumerator LV_ALIGN_OUT_LEFT_BOTTOM
  enumerator LV_ALIGN_OUT_RIGHT_TOP
  enumerator LV_ALIGN_OUT_RIGHT_MID
  enumerator LV_ALIGN_OUT_RIGHT_BOTTOM
      
    
     
  ```

  ```C++
  // lvgl.bj_set_pos()
  lvgl.obj_set_pos(image,20,20)
  /* 对于lua 语言使用这个函数可以正确地显示出图像的位置 */ 
  
  
  ```

  

- 

  ![img](https://dearliao.oss-cn-shenzhen.aliyuncs.com/Note/picture/202308161518214.jpg)





### 注意事项：

- LVGL 的底层固件，有NOLVGL 的固件。。。。这个固件里面没有这些函数，因此烧录进去之后可能不会执行。







### 踩坑记录：

- 驱动文件调用的默认disp 库的初始化，导致使用`lvgl` 的组件函数出现问题(报错问题 && 执行到某阶段程序卡死但不报错，直接看门狗重启)

  ```lua
  -- 下方代码 lvgl.obj_create() 函数可以执行，但执行到 lvgl.btn_create(scr)程序就退出，然后看门狗重启
      local scr = lvgl.obj_create(nil, nil)
      local btn = lvgl.btn_create(scr)
  ```

  原因：color_lcd_spi_st7789.lua  的初始化配置出错(我使用官方的LCD demo)。

  发现：官方的lvgl 中的demo 可以正常运行，而lcd 的demo 却出问题，因此考虑把出错的函数放到lvgl 的demo 中运行，发现并没有出现前面的问题，因此找到原因，是lcd 参数初始化没更改

  ```lua
  -- 修改1
          -- bus = disp.BUS_SPI4LINE, --标准SPI接口
          bus = lvgl.BUS_SPI4LINE,  -- 修改为LVGL 看看能不能成
  -- 修改2
      -- disp.init(para)
      -- disp.clear()
      -- disp.update()
  
      lvgl.disp_init(para)
  
  ```

  

- lvgl.init() 函数必须有，否则执行到下方 lvgl 的库的时候会报错







> temp  (临时记录文本使用)

```bash
# 1. 查看设备是否在线， Gateway Monitor 查找 Actual Heartbeat[GW -> MW]
如果 下方METERJSON 中包含 version ，并与表格进行比对，如果不正确就进行修正并标记


# 2. 查看设备的网络格式 Gateway Commands Response [GW -> MW -> HES]  from 8.15 to 8.16 并记录网络格式与比对，看看当前时间8.16 是否在线





```

































































































